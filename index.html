<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>문화·자연 유산 1인당 공공지출(UNESCO) 인터랙티브</title>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<style>
  :root { --bg:#0b0b0c; --fg:#eaeaea; --muted:#9aa1aa; --grid:#2b2f36; }
  body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Apple SD Gothic Neo, "맑은 고딕", sans-serif}
  header{padding:18px 20px 6px}
  h1{font-size:18px;margin:0 0 4px}
  .wrap{padding:0 16px 20px}
  .chart{max-width:1100px;margin:0 auto;background:#101216;border-radius:14px;box-shadow:0 0 0 1px #161a20}
  svg{display:block;width:100%;height:560px}
  .y .tick text{fill:var(--muted);font-size:11px}
  .y path, .y line{stroke:var(--grid)}
  .grid line{stroke:var(--grid)}
  .series{fill:none;stroke-width:2}
  .point{fill:#fff;stroke:#000;stroke-width:0.5;opacity:0}
  .point:hover{opacity:1}
  .tooltip{
    position:fixed;pointer-events:none;opacity:0;transition:opacity .12s ease;
    background:#11161d;color:#e9eef7;border:1px solid #1f2630;border-radius:10px;
    padding:10px 12px;font-size:12.5px;box-shadow:0 6px 24px rgba(0,0,0,.35)
  }
  .legend{display:flex;flex-wrap:wrap;gap:8px 14px;padding:10px 14px;border-top:1px solid #151a22;color:#b9c0c8}
  .legend .chip{display:inline-flex;align-items:center;gap:8px;font-size:12px;white-space:nowrap}
  .legend .sw{width:10px;height:10px;border-radius:10px;display:inline-block;box-shadow:0 0 0 1px rgba(0,0,0,.25) inset}
  footer{max-width:1100px;margin:10px auto 0;padding:0 16px 24px;color:#8f97a2;font-size:12px}
</style>
</head>
<body>
<header>
  <h1>총 1인당 공공지출(문화·자연 유산, PPP$2017 기준)</h1>
  <div style="color:#9aa1aa;font-size:12px">Y축 100–500(100 단위), X축은 연도 기준으로 배치(표시는 숨김)</div>
</header>

<div class="wrap">
  <div class="chart">
    <svg id="viz" viewBox="0 0 1200 560" preserveAspectRatio="xMidYMid meet" aria-label="UNESCO heritage public spending chart"></svg>
    <div class="legend" id="legend" aria-hidden="true"></div>
  </div>
</div>

<div class="tooltip" id="tt"></div>

<footer>
  데이터: UNESCO UIS (사용자 제공 파일). 시리즈는 값이 100~500 구간에 하나라도 포함될 때만 표시됩니다.
</footer>

<script>
(async function(){
  // 1) 데이터 로드 (같은 폴더의 data.json)
  const res = await fetch('data.json');
  const json = await res.json();
  const records = (json.records || [])
    .map(d => ({
      country: d.geoUnit,
      year: +d.year,
      value: +d.value
    }))
    .filter(d => Number.isFinite(d.year) && Number.isFinite(d.value));

  // 국가별로 그룹화 & 연도 정렬
  const byCountry = d3.group(records, d => d.country);
  for (const [k, arr] of byCountry) arr.sort((a,b)=>d3.ascending(a.year,b.year));

  // 차트 영역 설정
  const svg = d3.select('#viz');
  const { width, height } = svg.node().view
